<!DOCTYPE html><html lang="ja">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <meta http-equiv="Content-Script-Type" content="text/javascript">
  <script src="js/crypto-js.3.3.0.min.js"></script>
  <title>script test</title>
  <style>
    /* =========================================================
    ========================================================= */
    html {font-size:10pt;  /* 基本となる文字サイズ */}
    body {box-sizing: border-box;}  /* 枠線は要素サイズに含める */
    div {margin:0px;padding:0px;}
  </style>
  <style> input { width: 500px; } </style>
</head>

<body>
  <div id="crypto">
    <h1>指定文字列の暗号化/復号</h1>
    <p><label>暗号鍵</label><input type="text" name="key" onchange="convert()" value="Oct.22,2022" /></p>
    <p><label>文字列</label><input type="text" name="str" onchange="convert()" /></p>
    <div class="passPhrase"></div>
    <div class="str"></div>
    <div class="utf8_plain"></div>
    <div class="encrypted"></div>
    <div class="encryptResult"></div>
    <div class="decrypted"></div>
    <div class="txt_dexrypted"></div>
  </div>
</body>
<script type="text/javascript">
/*
  AES暗号化 (javascript)
  https://chakkari.org/blog/2020/05/03/aes-encrypt-with-javascript/
*/

const convert = () => {

  const v = {};

  // パスフレーズ（暗号鍵）
  v.passPhrase = document.querySelector('#crypto input[name="key"]').value;

  // 暗号化・復号化対象文字列
  v.str = document.querySelector('#crypto input[name="str"]').value;
  v.utf8_plain = CryptoJS.enc.Utf8.parse(v.str);

  // 暗号化
  v.encrypted = CryptoJS.AES.encrypt( v.utf8_plain, v.passPhrase );  // Obj
  v.encryptResult = v.encrypted.toString(); // toString()で文字列化

  // 復号化
  v.decrypted = CryptoJS.AES.decrypt( v.str , v.passPhrase );
  v.txt_dexrypted = v.decrypted.toString(CryptoJS.enc.Utf8);

  for( let x in v ){
    console.log(x,v[x]);
    const e = document.querySelector('#crypto .'+x);
    e.innerHTML = '<p style="color:red">_1 : _2</p>'.replace('_1',x).replace('_2',v[x]);
    e.innerHTML += '<p>type : _</p>'.replace('_',whichType(v[x]));
    e.innerHTML += '<p>length : _</p>'.replace('_',v[x].length);
    try {
      e.innerHTML += '<p>json : _</p>'.replace('_',JSON.stringify(v[x]));
    } catch(e) {
      console.error(e);
    }
  }

}

const whichType = (arg = undefined) => {
  return arg === undefined ? 'undefined'
   : Object.prototype.toString.call(arg).match(/^\[object\s(.*)\]$/)[1];
}
</script>
</html>