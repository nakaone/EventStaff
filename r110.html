<!DOCTYPE html><html lang="ja">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <meta http-equiv="Content-Script-Type" content="text/javascript">
  <title>おまつり奉行</title>
  <link rel="stylesheet" href="css/r110.css">
</head>

<body>
  <header>
    <div class="icon"><img src="img/stamp.png" /></div>
    <div class="title"><div class="test"></div><p></p></div>
    <div class="menuIcon"></div>
  </header>
  <nav></nav>
  <div id="main"></div>
</body>
<script src="js/jsQR.js" defer></script>
<script src="js/qrcode.min.js" defer></script>
<script src="js/Auth.js" defer></script>
<script src="js/menu.js" defer></script>
<script src="js/library.js" defer></script>
<script type="text/javascript">
const dom = {
  title: document.querySelector('header .title'),
  menuIcon: document.querySelector('header .menuIcon'),
  nav  : document.querySelector('nav'),
  main : document.querySelector('#main'),
};
let config;
/* debug: const config = {
  Auth:{
    url: 'https://script.google.com/macros/s/AKfycbz_dxbC3W0nbSOldTjxvy8jOoFbnbAG9IoMWNnm_MbO01ui0YZg0tdghQmmyW2yaeXW5w/exec',
  }
};*/
/** initialize: 初期設定
 * @param {void} - なし
 * @returns {void} なし
 */
const initialize = () => {
  console.log('initialize start.');
  console.log('config='+JSON.stringify(config));
  const menu = new Menu(dom);
  console.log('initialize end.');
}
/** messageBoard: お知らせ画面表示
 * @param {void} - なし
 * @returns {void} なし
 */
const messageBoard = () => {
  console.log('messageBoard');
}
/** reception: 受付業務画面表示
 * @param {void} - なし
 * @returns {void} なし
 */
const reception = () => {
  console.log('reception');
}
/** cornerOperation: コーナー運営画面表示
 * @param {void} - なし
 * @returns {void} なし
 */
const cornerOperation = () => {
  console.log('cornerOperation');
}
/** entry: 参加受付画面表示
 * @param {void} - なし
 * @returns {void} なし
 */
const entry = () => {
  console.log('entry');
}
/** referState: 予約状況参照画面表示
 * @param {void} - なし
 * @returns {void} なし
 */
const referState = () => {
  console.log('referState');
}
/** information: お役立ち情報画面表示
 * @param {void} - なし
 * @returns {void} なし
 */
const information = () => {
  console.log('information');
}
/** enquete: 参加者アンケート画面表示
 * @param {void} - なし
 * @returns {void} なし
 */
const enquete = () => {
  dom.title.innerText = '参加者アンケート';
  dom.main.innerHTML = `
    <p>本日参加された感想を是非以下にお寄せください。</p>
    <button>参加者アンケート</button>`;
  dom.main.querySelector('button').onclick = () => {
    window.open(config.public.EnqueteURL,'_blank');
  };
}
/** system: システム設定画面表示
 * @param {void} - なし
 * @returns {void} なし
 */
const system = () => {
  dom.title.innerText = 'システム設定';
  dom.main.innerHTML = '';

  // 掲示板他の定期的処理停止・再開
  if( (config.menuFlags & 16384) > 0 ){
    const o = genChild({tag:'div', children:[
      {tag:'h1', text:'定期的処理の停止・再開'},
      {tag:'input', type:'button', value:'再開', name:'start'},
      {tag:'input', type:'button', value:'停止', name:'stop'},
    ]},{},'root');
    if( toString.call(o.result).match(/Error/) ){  // エラーObjが帰ったら
      throw o.result;
    } else if( o.append ){  // 追加フラグがtrueなら親要素に追加
      dom.main.appendChild(o.result);
    }
  }

  // ヘルプ
  if( (config.menuFlags & 32768) > 0 ){
    const o = document.createElement('div');
    o.innerHTML = '<h1>ヘルプ</h1>'
    + '<details><summary>[Android]カメラを使おうとすると「使用できません」と表示される</summary>'
    +   '<p>ブラウザにカメラを使用する権限が付与されていない場合に表示されます。対応は以下の通りです(<a href="https://support.google.com/android/answer/9431959?hl=ja" target="_blank">出典</a>)。</p>'
    +   '<ol>'
    +     '<li>設定 > アプリ > 変更するアプリ(ブラウザ)を選択 > 権限 > カメラ</li>'
    +     '<li>「許可しない」から「アプリの使用中のみ許可」または「毎回確認する」に変更</li>'
    +   '</ol>'
    + '</details>';
    dom.main.appendChild(o);
  }

  // おまつり奉行について
  const o = document.createElement('div');
  o.innerHTML = '<h1>おまつり奉行について</h1>'
  + '<p>about OMATSURI-Bugyo</p>'
  + '<p>version: 1.1.0 (Dec.13,2022 released)</p>'
  + '<p>author : <a mailto="nakaone.kunihiro@gmail.com"><ruby><rb>嶋津　邦浩</rb><rt>2-2ゆうなパパ</rt></ruby></a> (Shimazu Kunihiro)</p>'
  + '<p>License: <a href="https://opensource.org/licenses/mit-license.php" target="_blank">MIT</a></p>';
  dom.main.appendChild(o);
}

window.addEventListener('DOMContentLoaded', function(){
  //debugここから
  //const auth = new Auth(dom);
  config = {"Auth":{"url":"https://script.google.com/macros/s/AKfycbz_dxbC3W0nbSOldTjxvy8jOoFbnbAG9IoMWNnm_MbO01ui0YZg0tdghQmmyW2yaeXW5w/exec","level":1,"key":""},"entryNo":1,"entryStr":"ined","AuthLevel":4,"menuFlags":32449,"editURL":"https://docs.google.com/forms/d/e/1FAIpQLSfIJ4IFsBI5pPXsLz2jlTBczzIn8QZQL4r6QHqxZmSeDOhwUA/viewform?edit2=2_ABaOnufCYALGfSCCaKbN4LDLlq9n6oTS8MfbMXvMVGeqH9hcsqj47n1z3eUW-muVZIhFFjg","public":{"level":65535,"Administrator":"shimokitasho.oyaji@gmail.com","FormId":"1hnQLsY3lRh0gQMGfXoJJqAL_yBpKR6T0h2RFRc8tUEA","SiteURL":"https://sites.google.com/view/shimokita-oyaji/home/archives/20221001-%E6%A0%A1%E5%BA%AD%E3%83%87%E3%82%A4%E3%82%AD%E3%83%A3%E3%83%B3%E3%83%97","MapURL":"materials/map.html","TableURL":"materials/timetable/WBS.html","EnqueteURL":"https://docs.google.com/forms/d/16r3luYQRiLVmI9xqaD4FuaSlUqTRGvI8nAGrjGcg8lc/viewform"}};
  initialize();
  //debug ここまで
  // 受付番号入力画面表示
  // getPassCode正常終了時、そこからinitializeを呼び出す
});
</script>
</html>
